<route-script>
    var __ace_style;

    app.title = '题目';
    app.links = [{ text: '题目列表', to: '/problem' }];

    component.data = function () {
        return { 
            title: null,
            background: null,
            description: null,
            inputFormat: null,
            outputFormat: null,
            sampleData: [],
            hint: null,
            timelimit: null,
            memorylimit: null,
            isSpecialJudge: null,
            source: null,
            control: {
                editorActiveTag: 'code',
                isInEditMode: false,
                languages: languages,
            },
            form: {
                code: '',
                language: null,
                data: []
            }
        };
    };

    component.created = function () {
        this.title = 'A+B Problem';
        this.description = 'Input 2 integers, output the sum result.';
        this.inputFormat = 'One line, contains two integer which splited by a space.';
        this.outputFormat = 'One line, the sum result.';
        this.sampleData = [{ input: '1 1', output: '2' }, { input: '2 5', output: '7' }];
        this.timelimit = 1000;
        this.memorylimit = 128 * 1024 * 1024;
        this.isSpecialJudge = false;
        this.source = '本地';
        this.form.language = app.preferences.language;
    };

    component.watch = {
        deep: true,
        title: function () {
            app.title = this.title;
        },
        'form.language': function (val) {
            if (val) {
                $('#code-editor')[0].editor.session.setMode('ace/mode/' + syntaxHighlighter[val]);
            }
        }
    };

    component.methods = {
        goToEditMode: function () {
            $('#code-editor')[0].editor.setValue(this.form.code);
            this.control.isInEditMode = true;
            app.fullScreen = true;
        },
        backToViewMode: function () {
            this.form.code = $('#code-editor')[0].editor.getValue();
            this.control.isInEditMode = false;
            app.fullScreen = false;
            $('.problem-body').attr('style', '');
        },
        addData: function () {
            this.form.data.push({ input: '', output: '' });
        },
        removeData: function (index) {
            if (index < this.form.data.length)
                this.form.data.splice(index, 1);
        },
        changeEditorMode: function (mode) {
            if (mode != 'code') {
                __ace_style = $('#code-editor').attr('class').replace('active', '').trim();
                $('#code-editor').attr('class', __ace_style);
            }
            this.control.editorActiveTag = mode;
            if (mode == 'code') {
                $('#code-editor').attr('class', __ace_style + ' active');
            }
        }
    };
</route-script>